<!DOCTYPE html>
<html lang="en-US">
  <head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<title>Generate an Org Chart image - US CMS Software and Computing</title>
<link rel="stylesheet" href="/assets/css/bootstrap.css" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/org-chart.css">
<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

  <body>
    
<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"><span><img height="64" src="/assets/logos/USCMS_SC_logo.png" alt="USCMS Software and Computing"></span>
          U.S. CMS Software and Computing
        </a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown active">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About</a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="/about/overview">Overview</a>
                        <a class="dropdown-item" href="/about/team">Team</a>
                        <a class="dropdown-item" href="/docs">Documentation</a>
                    </div>
                </li>
                <li class="nav-item dropdown active">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Areas</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                        
                        
                        <a class="dropdown-item" href="/wbs1-facilities.html">Facilities</a>
                        
                        <a class="dropdown-item" href="/wbs2-software.html">Software</a>
                        
                        <a class="dropdown-item" href="/wbs3-operations.html">Operations</a>
                        
                        <a class="dropdown-item" href="/wbs4-facilities.html">HL-LHC R&D</a>
                        
                    </div>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/postdocs">Research Initiative</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/interns">Interns</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/Contact">Contact</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

    <div id="container">
      <div class="container">
        <main role="main">

          <div class="container">

            <div id="chart" class="chart-container">
  <canvas id="connectorCanvas" width="1200" height="800"></canvas>
</div>

<script>
/* Parse Liquid-generated JSON */
const layoutMap = JSON.parse("{            \"management\": [                      {          \"name\": \"Tulika Bose\",          \"shortname\": \"tulika176\",          \"title\": \"S&C Operations Program Manager\",          \"institution\": \"University of Wisconsin-Madison\",          \"photo\": \"/assets/images/team/Tulika_Bose.jpg\"        },                      {          \"name\": \"Dirk Hufnagel\",          \"shortname\": \"d_hufnagel\",          \"title\": \"Deputy S&C Operations Program Manager\\n\",          \"institution\": \"Fermilab\",          \"photo\": \"/assets/images/team/Dirk-Hufnagel.jpg\"        },                      {          \"name\": \"Robert Tuck\",          \"shortname\": \"rct225\",          \"title\": \"Associate Project Manager\",          \"institution\": \"Princeton University\",          \"photo\": \"/assets/images/team/Robert-Tuck.jpg\"        }          ]              ,    \"facilities\": [                      {          \"name\": \"Andrew Melo\",          \"shortname\": \"PerilousApricot\",          \"title\": \"Facilities Co-Leader\",          \"institution\": \"Vanderbilt University\",          \"photo\": \"/assets/images/team/Andrew_Melo.jpg\"        },                      {          \"name\": \"David Mason\",          \"shortname\": \"d_mason\",          \"title\": \"Facilities Co-Leader\",          \"institution\": \"Fermilab\",          \"photo\": \"/assets/images/team/David_Mason.jpg\"        }          ]              ,    \"software\": [                      {          \"name\": \"Saba Sehrish\",          \"shortname\": \"ssehrish\",          \"title\": \"Software Co-leader\",          \"institution\": \"Fermilab\",          \"photo\": \"/assets/images/team/Saba_Sehrish.jpg\"        },                      {          \"name\": \"Kevin Lannon\",          \"shortname\": \"klannon\",          \"title\": \"Software Co-leader\",          \"institution\": \"University of Notre Dame\",          \"photo\": \"/assets/images/team/Kevin_Lannon.jpeg\"        }          ]              ,    \"operations\": [                      {          \"name\": \"Duong Nguyen\",          \"shortname\": \"nhduongvn\",          \"title\": \"Operations Co-Leader\",          \"institution\": \"University at Buffalo\",          \"photo\": \"/assets/images/team/Duong_Nguyen.jpg\"        },                      {          \"name\": \"Scarlet Norberg\",          \"shortname\": \"s_norberg\",          \"title\": \"Operations Co-Leader\\n\",          \"institution\": \"Fermilab\",          \"photo\": \"/assets/images/team/Scarlet-Norberg.png\"        }          ]          , \"hllhc\": [                          {        \"name\": \"Lindsey Gray\",        \"shortname\": \"l_gray\",        \"title\": \"HL-LHC R&D Co-Leader\",        \"institution\": \"Fermilab\",        \"photo\": \"/assets/images/team/Lindsey-Gray.png\"      }                          ,      {        \"name\": \"David Sperka\",        \"shortname\": \"dsperka\",        \"title\": \"HL-LHC R&D Co-Leader\",        \"institution\": \"Boston University\",        \"photo\": \"/assets/images/team/David_Sperka.jpg\"      }                                                                        ], \"analysis\": [                                            {        \"name\": \"Matteo Cremonesi\",        \"shortname\": \"mcremone\",        \"title\": \"HL-LHC R&D Analysis Systems Coordinator\",        \"institution\": \"Carnegie Mellon University\",        \"photo\": \"/assets/images/team/Matteo_Cremonesi.jpg\"      }                                                                  ,      {        \"name\": \"Oksana Shadura\",        \"shortname\": \"oshadura\",        \"title\": \"HL-LHC R&D Analysis Systems Coordinator\",        \"institution\": \"University of Nebraska - Lincoln\",        \"photo\": \"/assets/images/team/Oksana-Shadura_.jpg\"      }            ], \"infra\": [                                                                          {        \"name\": \"Nick Smith\",        \"shortname\": \"nsmith-\",        \"title\": \"U.S. CMS Fermilab Facility Architect\",        \"institution\": \"Fermilab\",        \"photo\": \"/assets/images/team/Nick_Smith.jpg\"      }                          ,      {        \"name\": \"James Letts\",        \"shortname\": \"j_letts\",        \"title\": \"U.S. CMS University Facility Architect\",        \"institution\": \"UC San Diego\",        \"photo\": \"/assets/images/team/James_Letts.jpg\"      }                      ], \"algo\": [                                                      {        \"name\": \"Philip Chang\",        \"shortname\": \"pchang\",        \"title\": \"HL-LHC R&D Algorithms Coordinator\",        \"institution\": \"University of Florida\",        \"photo\": \"/assets/images/team/Philip_Chang.png\"      }                                                    ], \"blueprint\": [                                                                {        \"name\": \"David Lange\",        \"shortname\": \"dlange\",        \"title\": \"Computational Physicist\",        \"institution\": \"Princeton University\",        \"photo\": \"/assets/images/team/David-Lange.png\"      }                                          ]}");
const titles = JSON.parse("{  \"management\": \"Software & Computing\",  \"facilities\": \"Facilities\",  \"software\": \"Software\",  \"operations\": \"Operations\",  \"hllhc\": \"HL-LHC R&D\",  \"analysis\": \"Analysis\",  \"infra\": \"Infrastructure\",  \"algo\": \"Algorithms\",  \"blueprint\": \"Blueprint\"}");
const instShortByPerson = JSON.parse("{                                                                                }");

/* Positions: Blueprint intentionally excluded */
const positions = {
  management: {left:450, top:40,   title:"Software & Computing", type:"root"},
  facilities: {left:300, top:220,  title:"Facilities", type:"leaf"},
  software:   {left:300, top:360,  title:"Software", type:"leaf"},
  operations: {left:600, top:220,  title:"Operations", type:"leaf"},
  hllhc:      {left:600, top:360,  title:"HL-LHC R&D", type:"leaf"},
  infra:      {left:360, top:500,  title:"Infrastructure", type:"leaf"},
  algo:       {left:470, top:500,  title:"Algorithms", type:"leaf"},
  analysis:   {left:580, top:500,  title:"Analysis", type:"leaf"}
  
  /*
  Example: If you ever want to show Blueprint (currently invisible),
  just uncomment and adjust coordinates like so:

  blueprint: {left:900, top:500, title:"Blueprint", type:"leaf"}
  */
};

/* Overlay YAML titles */
Object.keys(positions).forEach(k => {
  if (titles[k]) positions[k].title = titles[k];
});

/* Titles to always display */
const showTitleForShort = new Set(["tulika176","d_hufnagel","rct225","j_letts","nsmith-"]);

const chart = document.getElementById('chart');

/* Photo helpers */
// function addPhotos(key, div, names){
//   if (["facilities","software"].includes(key)) {
//     names.forEach((p,i)=>{
//       const img = document.createElement('img');
//       img.className = 'photo-left';
//       if (i === 1) img.style.left = '-170px';
//       if (p.photo) img.src = p.photo;
//       img.alt = p.name;
//       div.appendChild(img);
//     });
//   } else if (["operations","hllhc"].includes(key)) {
//     names.forEach((p,i)=>{
//       const img = document.createElement('img');
//       img.className = 'photo-right';
//       if (i === 1) img.style.right = '-170px';
//       if (p.photo) img.src = p.photo;
//       img.alt = p.name;
//       div.appendChild(img);
//     });
//   } else if (key === "management") {
//     names.forEach((p,i)=>{
//       const img = document.createElement('img');
//       img.className = i === 0 ? 'photo-left' : 'photo-right';
//       if (i === 1) img.style.right = '-85px';
//       if (i === 2) img.style.right = '-170px';
//       if (p.photo) img.src = p.photo;
//       img.alt = p.name;
//       div.appendChild(img);
//     });
//   } else if (["infra","algo","analysis"].includes(key)) {
//     const imgSize = 75;
//     const gap = 8;
//     const count = names.length;
//     const groupWidth = count * imgSize + Math.max(0, count - 1) * gap;
//     const nodeW = div.offsetWidth;
//     const startX = Math.max(0, Math.round((nodeW - groupWidth) / 2));
//     names.forEach((p,i)=>{
//       const img = document.createElement('img');
//       img.className = 'photo-below';
//       img.style.left = `${startX + i * (imgSize + gap)}px`;
//       if (p.photo) img.src = p.photo;
//       img.alt = p.name;
//       div.appendChild(img);
//     });
//   }
// }

function addPhotos(key, div, names){
  if (["facilities","software"].includes(key)) {
    names.forEach((p,i)=>{
      const ph = document.createElement('div');
      ph.className = 'photoBox photo-left';
      if (i === 1) ph.style.left = '-170px';
      if (p.photo) ph.style.backgroundImage = `url("${p.photo}")`;
      div.appendChild(ph);
    });
  } else if (["operations","hllhc"].includes(key)) {
    names.forEach((p,i)=>{
      const ph = document.createElement('div');
      ph.className = 'photoBox photo-right';
      if (i === 1) ph.style.right = '-170px';
      if (p.photo) ph.style.backgroundImage = `url("${p.photo}")`;
      div.appendChild(ph);
    });
  } else if (key === "management") {
    names.forEach((p,i)=>{
      const ph = document.createElement('div');
      ph.className = 'photoBox ' + (i===0 ? 'photo-left' : 'photo-right');
      if (i === 1) ph.style.right = '-85px';
      if (i === 2) ph.style.right = '-170px';
      if (p.photo) ph.style.backgroundImage = `url("${p.photo}")`;
      div.appendChild(ph);
    });
  } else if (["infra","algo","analysis"].includes(key)) {
    const imgSize = 75, gap = 8, count = names.length;
    const groupWidth = count * imgSize + Math.max(0, count - 1) * gap;
    const nodeW = div.offsetWidth;
    const startX = Math.max(0, Math.round((nodeW - groupWidth) / 2));
    names.forEach((p,i)=>{
      const ph = document.createElement('div');
      ph.className = 'photoBox photo-below';
      ph.style.left = `${startX + i * (imgSize + gap)}px`;
      if (p.photo) ph.style.backgroundImage = `url("${p.photo}")`;
      div.appendChild(ph);
    });
  }
}


/* Render a node */
function mkNode(key){
  const {left, top, title, type} = positions[key];
  const div = document.createElement('div');
  div.className = `node ${type}`;
  div.style.left = `${left}px`;
  div.style.top  = `${top}px`;

  const box = document.createElement('div');
  box.className = 'node-box';

  const strong = document.createElement('strong');
  strong.textContent = title;
  box.appendChild(strong);

  const names = (layoutMap[key]||[]).filter(Boolean);

  names.forEach(p => {
    const instShort = instShortByPerson[p.shortname] || p.institution || "";
    const nameLine = document.createElement('div');
    nameLine.className = 'person-line';
    nameLine.textContent = instShort ? `${p.name} (${instShort})` : p.name;
    box.appendChild(nameLine);

    if (showTitleForShort.has(p.shortname) && p.title) {
      const t = document.createElement('div');
      t.className = 'title-line';
      t.textContent = p.title;
      box.appendChild(t);
    }
  });

  div.appendChild(box);
  chart.appendChild(div);
  addPhotos(key, div, names);

  return div;
}

/* Build nodes */
const nodes = {};
Object.keys(positions).forEach(k => { nodes[k]=mkNode(k); });

/* Connectors */
const canvas = document.getElementById('connectorCanvas');
const ctx = canvas.getContext('2d');
ctx.lineWidth = 2; ctx.strokeStyle = '#000';

function rect(el){ const r = el.getBoundingClientRect(), p = canvas.getBoundingClientRect(); return {
  left:r.left-p.left, right:r.right-p.left, top:r.top-p.top, bottom:r.bottom-p.top, width:r.width, height:r.height
};}
function center(el){ const r=rect(el); return {x:r.left+r.width/2,y:r.top+r.height/2};}
function topCenter(el){ const r=rect(el); return {x:r.left+r.width/2,y:r.top};}
function bottomCenter(el){ const r=rect(el); return {x:r.left+r.width/2,y:r.bottom};}
function line(x1,y1,x2,y2){ ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke(); }
function setLeftByCenter(nodeEl, targetCenterX){
  const r = rect(nodeEl);
  nodeEl.style.left = `${Math.round(targetCenterX - r.width/2)}px`;
}

window.onload = () => {
  const {management, facilities, software, operations, hllhc, infra, algo, analysis} = nodes;

  const trunkX = (center(facilities).x + center(operations).x) / 2;
  setLeftByCenter(management, trunkX);

  const hCenter = center(hllhc).x;
  const smallGap = 220;
  const centers = [hCenter - smallGap, hCenter, hCenter + smallGap];
  [infra, algo, analysis].forEach((el, i) => setLeftByCenter(el, centers[i]));

  ctx.clearRect(0,0,canvas.width,canvas.height);

  const yConnector = center(software).y;
  line(bottomCenter(management).x, bottomCenter(management).y, bottomCenter(management).x, yConnector);

  line(center(facilities).x, center(facilities).y, center(operations).x, center(operations).y);
  line(center(software).x, center(software).y, center(hllhc).x, center(hllhc).y);

  const barY = topCenter(infra).y - 20;
  line(center(hllhc).x, bottomCenter(hllhc).y, center(hllhc).x, barY);

  [infra, algo, analysis].forEach(node=>{
    line(center(hllhc).x, barY, center(node).x, barY);
    line(center(node).x, barY, topCenter(node).x, topCenter(node).y);
  });
};
</script>

<!-- 2) Add a button near the chart -->
<p><button id="savePng">
  Download PNG
</button></p>

<!-- 3) Add this script block (after your existing <script> that renders the chart) -->
<script>
  // If your photos might be cross-origin, ensure images don't taint the capture:
  // (You already create <img> elements in addPhotosâ€”this sets crossOrigin there.)
  const originalAddPhotos = addPhotos;
  addPhotos = function(key, div, names){
    names.forEach(p => { if (p && p.photo) { /* hint for CORS */ } });
    originalAddPhotos(key, div, names);
    // Set crossOrigin on any images we just appended
    div.querySelectorAll('img').forEach(img => {
      if (!img.crossOrigin) img.crossOrigin = 'anonymous';
      // If images are on a CDN you control, make sure it sends: Access-Control-Allow-Origin: *
    });
  };

  document.getElementById('savePng').addEventListener('click', async () => {
    const chartEl = document.getElementById('chart');

    // Ensure the connector canvas is up to date (your code already draws on load)
    // Optionally re-run your layout routine here if you draw on resize.

    // 2x scale = sharper export; increase to 3 for print quality
    const scale = 3;

    const canvas = await html2canvas(chartEl, {
      backgroundColor: '#fff',
      scale,
      useCORS: true,
      logging: false,
      windowWidth: chartEl.scrollWidth,
      windowHeight: chartEl.scrollHeight
    });

    const link = document.createElement('a');
    link.download = 'uscms-sc-org-chart.png';
    link.href = canvas.toDataURL('image/png');
    link.click();


  });
</script>


          </div>
        </main>
      </div>

          <footer>
  <div class="footer-dark">
    <div class="container">
      <div class="d-flex flex-row">
        <div class="footer-vertical-center">
          <div class="footer-logos">
            <div class="footer-logo">
              <img src="/assets/logos/USCMS_SC_logo.png" alt="USCMS logo">
            </div>
            <div class="footer-logo">
              <img src="/assets/logos/doe.png" alt="DOE logo">
            </div>
            <div class="footer-logo">
              <img src="/assets/logos/nsf-logo-128.png" alt="NSF logo">
            </div>

          </div>
        </div>

        <div class="footer-text p-2 ml-auto flex-grow-1 footer-vertical-center">

        </div>
        </div>
      </div>
    </div>
</footer>

    </div>
  </body>
</html>
