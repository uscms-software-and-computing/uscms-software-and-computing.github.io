<!doctype html>

<html lang="en-US">
    <head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<title>Post-doctoral researcher - US CMS Software and Computing</title>
<link rel="stylesheet" href="/assets/css/bootstrap.css" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/css/style.css">
<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

  <body>

    
<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"><span><img height="64" src="/assets/logos/USCMS_SC_logo.png" alt="USCMS Software and Computing"></span>
          U.S. CMS Software and Computing
        </a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown active">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About</a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="/about/overview">Overview</a>
                        <a class="dropdown-item" href="/about/team">Team</a>
                        <a class="dropdown-item" href="/docs">Documentation</a>
                    </div>
                </li>
                <li class="nav-item dropdown active">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Areas</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                        
                        
                        <a class="dropdown-item" href="/wbs1-facilities.html">Facilities</a>
                        
                        <a class="dropdown-item" href="/wbs2-software.html">Software</a>
                        
                        <a class="dropdown-item" href="/wbs3-operations.html">Operations</a>
                        
                        <a class="dropdown-item" href="/wbs4-facilities.html">HL-LHC R&D</a>
                        
                    </div>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/postdocs">Research Initiative</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/interns">Interns</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/Contact">Contact</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

    



<div id="container">
  <div class="container">
    <main role="main">

      <div>
        <br>
        <center><h1>USCMS Researcher: Nick Manganelli</h1>

          <img src="/assets/images/team/Nick-Manganelli.jpg" width="150px">
          <br>
          <br>
          <b> Postdoc dates: </b>
          Jan 2023 - Jan 2025<br/>

          <br>
          <b> Home Institution:</b> University of Colorado Boulder
          <br>
          <br>
        </center>

        <br>
        <h3>Project: On Demand Column Joining with ServiceX (2024) and Advancing Machine Learning Inference with Columnar Analysis at CMS Analysis Facilities (2023)</h3>

        Column-Joining's purpose is to prototype on-demand column-joining leveraging tools like ServiceX, distributed SQL services (such as trino), dask, and kafka to serve needs of an envisioned HL-LHC computing model, ameliorating the need for permanent storage of augmented data from CMS NanoAOD and larger data tiers. The Triton inference project's purpose was to develop and benchmark the usage of rapid Machine Learning Inference-as-a-Service together with columnar analysis in the Fermilab Elastic Analysis Facility for the next generation HL-LHC computing model.
        <br>
        <br>
        More information: <a href = "/assets/pdfs/ColumnJoining_MLInfColumnar_Combined.pdf">My project proposal</a><br> 

        <br>
        <b>Mentors: </b> <br>
        <ul>
          
          <li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <p>Keith Ulmer (University of Colorado Boulder)</p>

            
          </li>
          
        </ul>
        


        <b>Presentations</b>
        <ul>
          
          
          <li>3 Apr 2023 - <a href="https://indico.cern.ch/event/1272845/contributions/5344724/attachments/2623810/4537142/NickManganelli_HLLHCR&D_03_04_2023.pdf">"Triton Inference and Columnar Analysis"</a>, Nick Manganelli, <a href="https://indico.cern.ch/event/1272845/">HL-LHC R&D Initiative Meeting</a>
            
          
          
          <li>10 Dec 2023 - <a href="https://github.com/nickmanganelli-sr/cofi-2023">"Basic tools and resources needed for machine learning"</a>, Nick Manganelli, <a href="https://indico.cern.ch/event/1299889">2nd COFI Advanced Instrumentation and Analysis Techniques School</a>
            
          
          
          <li>1 Mar 2024 - <a href="">"ServiceX and column joining"</a>, Nick Manganelli, <a href="https://indico.cern.ch/event/1367741/#10-servicex-and-column-joining">IRIS-HEP / AGC Demo Day</a>
            
          
          
          <li>18 Jun 2024 - <a href="https://indico.cern.ch/event/1352950/contributions/5922016/attachments/2879607/5044412/NickManganelli_USCMS_TritonPySONIC_18_06_2024.pdf">"Benchmarking Scalable Triton Inference at Fermilab's Elastic Analysis Facility"</a>, Nick Manganelli, <a href="https://indico.cern.ch/event/1352950/">2024 US CMS Annual Collaboration Meeting</a>
            
          
        </ul>
        <hr>

        <b>Current Status</b>
        <br>
        <p><br /> <b>On Demand Column Joining with ServiceX</b> <br /></p>
<ul>
  <li>Q1 2024 Progress Report
    <ul>
      <li>Work with Ben Galewsky (NCSA - UIUC), developer of ServiceX, and Burt Holzman (Fermilab) has begun on this project.</li>
      <li>Ben and Burt have deployed ‘trino,’ a distributed SQL service, at Fermilabs Elastic Analysis Facility.</li>
      <li>I have set up pipelines to ingest CMS Open Data in a NanoAOD(-like) format and convert from root to parquet, run an advanced Machine Learning model (ParticleNet, a Graph Neural Net used throughout CMS for flavor tagging and other tasks), and stored these data (separately) in a server accessible by trino.</li>
      <li>Ben has tested running joins of these converted data and inference data together, on-demand, and found that O(10M) events can be zipped together by trino in less than a minute (when outputting approximately 3 dozen columns). I have tested ingesting the output joined data and running it through rudimentary analysis.</li>
      <li>Along the way, a few bugs have been found and fixed in various packages, and a few features requested
        <ul>
          <li><a href="https://github.com/scikit-hep/awkward/issues/3033">https://github.com/scikit-hep/awkward/issues/3033</a></li>
          <li><a href="https://github.com/dask-contrib/dask-awkward/issues/472">https://github.com/dask-contrib/dask-awkward/issues/472</a></li>
          <li><a href="https://github.com/scikit-hep/hepconvert/issues/72">https://github.com/scikit-hep/hepconvert/issues/72</a></li>
          <li><a href="https://github.com/scikit-hep/hepconvert/issues/73">https://github.com/scikit-hep/hepconvert/issues/73</a></li>
          <li><a href="https://github.com/CoffeaTeam/coffea/issues/1010">https://github.com/CoffeaTeam/coffea/issues/1010</a></li>
        </ul>
      </li>
      <li>The developments were presented at the IRIS-HEP March 1 Demo Days at <a href="https://indico.cern.ch/event/1367741/">https://indico.cern.ch/event/1367741/</a> (no presentation/recording; live demo)</li>
      <li>While Ben and Burt work on the ServiceX deployment at Fermilab’s Elastic Analysis Facility (which will enable the large-scale, on-demand conversion of root data to parquet, as required by trino before joining), I will work on several components necessary to create an analysis pipeline, including identifying which columns of data are needed from each set of columns to be joined, automatic creation of SQL queries to produce the desired output in a joined fashion, etc. Further benchmarking, at more and more demanding scales, is foreseen. There are many open questions, including what kind of storage cluster deployment will be needed, server resources required, whether trino should be addressed directly or indirectly (via ServiceX), and so on. These will be explored in the coming months, at the appropriate time (considering development timeline)</li>
    </ul>
  </li>
  <li>Q2 2024 Progress Report
    <ul>
      <li>Project is slightly ahead of milestone schedule, with some mix of objectives from later quarters already reached (detailed breakdown below with comments)</li>
      <li>Approximately 1.5 months of work (50% FTE) has been deferred to later in the year due to series of talks and trainings, including the Triton R&amp;D Talk at USCMS and coffea tutorials at USCMS/IRIS-HEP event)</li>
      <li>Work has started on the work to chain together column-joining components from the March demonstrator into a cohesive, easy-to-use tool for end-user analysis. Several sub-components for this must be developed and have been identified, outlined separately as End-to-End Pipeline Elements</li>
      <li>Stakeholders believe the above can be accomplished end-to-end (fallback; being able to generate joined data with (super)set of necessary columns for an analysis and caching it for repeated use, as originally enivisioned for the project, should still be feasible should End-to-End not work)</li>
      <li>In parallel, larger-scale tests with more events will be done to test the scalability and robustness of trino for joining data and delivering it (promising event rates from March demonstrator; 10s of millions of events joined on the order of minutes)</li>
      <li>A move from MinIO storage to native Ceph (and potentially leveraging native Object Storage) is being considered for testing</li>
    </ul>
  </li>
  <li>End-to-End Pipeline Elements
    <ul>
      <li>Be able to instantiate typetracers for coffea/dask-awkward analysis using ‘two’ parallel sources (e.g. ROOT primary source and ROOT/parquet secondary source)  and push them through analysis code to generate the dask task-graphs</li>
      <li>Use the necessary_columns tooling of dask, in conjunction with above, as an input to a ServiceX query-builder to convert automatically any ROOT formatted data, and potentially leverage automatic skimming/slimming (i.e. predicate pushdown) on parquet sources</li>
      <li>Similarly, use the necessary_columns functionality as input to a joins-query builder, whose product will be sent to trino (distributed SQL service) in order to take data in parquet format and perform the actual data joins</li>
      <li>Any remaining code to ensure the output can be delivered to the user’s analysis when the task-graph is computed, ideally as dask tasks themselves</li>
    </ul>
  </li>
  <li>Project Milestones
    <ul>
      <li>Quarter 1
        <ul>
          <li>Familiarization with ServiceX software, current deployments, and internal query language (func adl) - <i><b>Complete</b></i></li>
          <li>Development of representative ServiceX code and input data for tests of column joining. - <i><b>Complete</b></i></li>
        </ul>
      </li>
      <li>Quarter 2
        <ul>
          <li>Understand whether and how joining can be accomplished prior to delivery (as part of the ServiceX pipeline) - <i><b>Partially Complete</b></i></li>
          <li>Prototype of the full chain (using manual conversions, join-queries, etc) has been demonstrated with both ordered and out-of-order joins</li>
          <li>…and after delivery (as part of an analysis framework like coffea - <i><b>Incomplete</b></i></li>
          <li>This may still be useful, but will be pursued after a full-chain/End-to-end approach, fully leveraging ServiceX, has been demonstrated</li>
          <li>Identify missing components for column joining, work with ServiceX, dask, coffea, and other scikit-hep experts to develop and test code. - <i><b>Partially Complete</b></i></li>
          <li>Work has begun on the missing components to build a cohesive pipeline end-to-end, such that there will be no manual steps involved which would require expertise beyond the typical analysts’ repertoire</li>
        </ul>
      </li>
      <li>Quarter 3
        <ul>
          <li>Demonstrate feasibility of column joining between two aligned event trees. Representative data is preferentially CMS NanoAOD (similarly, may be from ATLAS DAOD PhysLite), in which events do not need to be re-grouped or re-ordered prior to joining (1-to-1 file and event order relationship). This is comparable to simple Friend Trees in ROOT. - <i><b>Complete</b></i></li>
          <li>Demonstrated immediately out-of-order (but with no missing data) joins between parquet data from a full-conversion of stock NanoAOD + parquet files storing ParticleNet inference results, demonstrating a common modality of using ‘cached’ ML results instead of re-running or storing permanently in augmented NanoAOD format (with all other input variables from the ‘central’ dataset replicated)</li>
        </ul>
      </li>
      <li>Quarter 4 - Float and Extended (Optional) Objectives
        <ul>
          <li>Demonstrating multi-dataset combinations - <i><b>Incomplete</b></i></li>
          <li>This will be useful for combining systematics-trees as is used in some CMS analyses and very commonly in ATLAS, and is ideally a natural extension of two-source joins already demonstrated. If multi-source joins are not feasible in the currently chosen service, a tree-reduction approach should be equivalent even if less performant, iteratively using two-source joins</li>
          <li>Non-trivial joins (i.e. Indexed Friend Trees) - <i><b>Partially Complete</b></i></li>
          <li>Equivalent of one part of indexed joins has been demonstrated with March out-of-order demonstrator; handling unaligned (missing data) still to be shown. Tooling to do this automatically instead of manually running components still under development</li>
          <li>Non-trivial joins (… inner or outer joins) - <i><b>Incomplete</b></i></li>
          <li>Still to be demonstrated, but no showstoppers known of with prospective tools</li>
          <li>Test combinations of disparate CMS data tiers in a deployment of ServiceX at an Analysis Facility - <i><b>Incomplete</b></i></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Next Steps
    <ul>
      <li>Prototype the first of the End-to-End Pipeline Elements, creating a join-aware typetracer to pass through dask_awkward/coffea analysis</li>
      <li>Scale up demonstrator to larger datasets, joining together more columns, and stress testing the distributed SQL infrastructure</li>
    </ul>
  </li>
</ul>

<p><br /> <b>Advancing Machine Learning Inference with Columnar Analysis at CMS Analysis Facilities</b> <br />
Paper <a href="https://doi.org/10.1007/s41781-024-00123-2">Optimizing High Throughput Inference on Graph Neural Networks at Shared Computing Facilities with the NVIDIA Triton Inference Server</a> published in Computing and Software for Big Science. Benchmarks have been completed of the EAF’s Scalable Nvidia Triton System. Simple scaling tests show that the simple comparison of serial requests for inference of a two-class ParticleNet model attain speedups of approximately 50x using Triton on a 2.20GB MIG slice of an A100 GPU at the EAF, relative to a typical worker node in the LPC interactive nodes. While benchmarking, we discovered inefficiencies in the scaling of the Triton system, which resulted in too many servers spinning up for the number of requests being received. After tuning, we attained linear scaling of net inference rate with Triton server instances, indicating near-ideal scale-up parameters for the models under test. Tests of the basic networking characteristics demonstrate that the kinds of models oftend deployed in analysis now, such as BDTs, can easily see slowdown using the Triton server infrastructure, due to the overhead of transmitting the inputs and outputs over the network. More compute-heavy models, such as ResNet50 and the aforementioned ParticleNet model, however, see notable and significant (respectively) gain due to the balance of computational (inference) time and network transmission time. Another result from our research is that the current default Triton behaviour with regards to simultaneously handling multiple models is not ideal. When multiple models are receiving inference requests on a given Triton server instance, each one builds and fills a request queue in main RAM. Due to contention for resources, whether it’s in main RAM, over the PCIe Bus, for the GPU RAM, or compute, we see that inference efficiency can drop significantly, by approximately a factor of 5. This indicates that a better behaviour to orchestrate, when multiple models are being requested and when multiple servers are available, is to concentrate model requests of the same type (and potentially the same
                                             computation engine, such as
                                             torch or tensorflow) in the same
server. Such capability is currently reserved for Nvidia AI Enterprise customers, however. Regardless, Triton proves to be a highly-efficienty ML Inference service, which is easy to use at the LPC/EAF, and can support requests from hundreds of worker nodes in parallel. The usage of this service by LPC analysts should be highly encouraged, in order to preserve other GPU usage for other tasks, such as model training. The paper has been accepted for publication in CSBS and is available on the <a href="https://arxiv.org/abs/2312.06838">arXiv</a></p>
<ul>
  <li>Q2 2023 Progress Report
    <ul>
      <li>We created a fork of the tests developed in the first quarter of the project, removing the reliance on CMS data and increasing the system stress to identify maximum throughput of the Elastic Analysis Facility Triton Server.</li>
      <li>We identified scaling behavior with multiple models that suggests a need for more advanced orchestration than is in the baseline software.</li>
      <li>We have submitted requests to Nvidia to gain access to beta software with features that may resolve most or all of our scaling performance (inventing the features ourselves would be a considerable investment).</li>
      <li>Claire Savard, Burt Holzman and I (with significant suggestions and review from Lindsey Grey, Kevin Pedro, Keith Ulmer, Kevin Stenson) completed and submitted a paper summarizing results of benchmarking the EAF Triton Server to NeurIPS 2023. We are expecting feedback soon, and acceptance/rejection by the end of the 3rd quarter.</li>
    </ul>
  </li>
  <li>Q3 2023 Progress Report
    <ul>
      <li>Our paper submission to NeurIPS 2023 received reviews which reflected a reluctance to accept the paper, mainly criticizing our choice of target journal; it was felt that others would be more appropriate for our results, which are benchmarking systems and testing interoperability rather than demonstrating novel algorithm development, for example. We withdrew the submission and are searching for a more appropriate journal.</li>
      <li>Amongst the results that went into our paper submission, we had found a notable bottleneck in usage of IaaS through Triton for multiple users (to be reported at a future R&amp;D Meeting), resulting in some inefficiency for the system.</li>
      <li>Preliminary studies indicate we can remove this bottleneck through more intelligent model orchestration. The feature to do so existed in Nvidia as an alpha release feature, but multiple attempts to contact Nvidia and attain access were unsuccessful. The feature has recently come out of alpha, but is now exclusively available as part of an Nvidia Enterprise 4.0 service. Addressing this would lead to a desirable optimization, but in no way does it prevent us from delivering and supporting the service, which will still be the most efficient method of high-throughput ML inference for a multi-tenant Analysis Facility.</li>
    </ul>
  </li>
  <li>Q4 2023 Progress Report
    <ul>
      <li>The paper has been reworked and submitted to Computing and Software for Big Science and uploaded to the arXiv at <a href="https://arxiv.org/abs/2312.06838">https://arxiv.org/abs/2312.06838</a>.</li>
      <li>Several new results were added for different models, to demonstrate the scaling behavior with regard to different archetypes. Network-focused studies were added to appendices, and language was notably improved.</li>
      <li>Funding for the open-access submission was attained by our graduate student, Claire Savard (advisor Kevin Stenson).</li>
      <li>A tutorial on the usage of Nvidia Triton Inference was completed as part of a seminar at the <a href="https://indico.cern.ch/event/1299889/timetable/?view=standard_inline_minutes">COFI 2023 Winter School</a></li>
      <li>The git repository holding the benchmark code is available at <a href="https://github.com/cgsavard/triton_multiuser_benchmarks">https://github.com/cgsavard/triton_multiuser_benchmarks</a></li>
    </ul>
  </li>
</ul>

        <br>
        <br>
        
        <b>Contact me:</b><br>
        <ul>
          
          <li>
            <i class="fas fa-envelope-square"></i><a href = "mailto:nmangane@cern.ch"> Send me an email</a><br>
          </li>
          
          
          
           
          
        </ul>

        <div>
          

        </div>

      </div>
    </main>
  </div>
  <footer>
  <div class="footer-dark">
    <div class="container">
      <div class="d-flex flex-row">
        <div class="footer-vertical-center">
          <div class="footer-logos">
            <div class="footer-logo">
              <img src="/assets/logos/USCMS_SC_logo.png" alt="USCMS logo">
            </div>
            <div class="footer-logo">
              <img src="/assets/logos/doe.png" alt="DOE logo">
            </div>
            <div class="footer-logo">
              <img src="/assets/logos/nsf-logo-128.png" alt="NSF logo">
            </div>

          </div>
        </div>

        <div class="footer-text p-2 ml-auto flex-grow-1 footer-vertical-center">

        </div>
        </div>
      </div>
    </div>
</footer>

</div>

</body>
</html>
